var n=Object.assign;import{R as e,l as a}from"./rank.service.b9cb579c.js";import{_ as t}from"./rank-player.4a000fdc.js";import{$ as r}from"./event-bus.2e8a8b75.js";import{d as o,r as s,e as l,a as _,o as i,c,N as u,b as m,w as p,F as d,i as g}from"./index.8f109ae7.js";import"./vendor.da44e350.js";const w=r,k=[];var v=o({components:{},unmounted:()=>{r.remove(k),k.length=0},setup(e){const a=s({count:1}),t=s({on_count:null,onSelect:null});t.on_count=n=>{};const o=l(!1);var _,i;_=w.rank_show_actions,i=()=>{o.value=!0},k.push(r.on(_,i)),t.onSelect=n=>{n.handle&&(n.handle(),o.value=!1)};return n({state:a,menus:[{name:"调整分组",handle:()=>{r.emit(w.rank_toggle_edit_mode)}},{name:"历史记录"},{name:"选项三"}],showPopover:o,props:e},t)}});v.render=function(n,e,a,t,r,o){const s=_("van-action-sheet");return i(),c(s,{show:n.showPopover,"onUpdate:show":e[1]||(e[1]=e=>n.showPopover=e),actions:n.menus,onSelect:n.onSelect},null,8,["show","actions","onSelect"])};const h=r,y=[],f=e;var x=o({components:{RankPlayer:t,RankAction:v},unmounted:()=>{r.remove(y),y.length=0},setup(t){e.init_event(),e.load_rank_doc();const o={player_arr:[]},_=()=>{o.player_arr=a.orderBy(e.state.player_arr,["score"],["desc"])};var i,c;_(),i=h.rank_jifen_vs_changed,c=()=>{_()},y.push(r.on(i,c));const m=s({on_commit_game:null,get_vs_title:null,on_change:null,on_win_player:null,on_down_winning_streak:null,on_edit_max_winning_streak:null,on_edit_group_name:null}),p=s({checked_edit_mode:l(!1),max_winning_streak:l(5)});m.on_commit_game=n=>{if(n>1)f.down_player([o.player_arr[0],o.player_arr[1]]);else{let n=Math.random()>.5?1:0;[o.player_arr[n]].map((n=>{n.score+=Math.floor(2*Math.random())+1})),f.down_player([o.player_arr[n]])}},m.get_vs_title=()=>{let n="";if(2===o.last_vs_arr.length){let[e,a]=o.last_vs_arr;n=`${e.name} [${e.winning_streak} vs ${a.winning_streak}] ${a.name}`}let e="";return o.loser_arr.length&&o.loser_arr.map((n=>{e+=" #"+n.name})),[n,e]},m.on_change=()=>{},m.on_down_winning_streak=()=>{a.take(e.state.player_arr,2).map((n=>{n.winning_streak>0&&(n.winning_streak>=e.state.max_winning_streak?f.down_player([n]):u("没到连胜下场次数"+e.state.max_winning_streak))}))},m.on_win_player=n=>{let t=a.take(e.state.player_arr,2);t[n].winning_streak++;let r=t[(n+1)%2];r.winning_streak=0,f.down_player([r])};const d=l(5),g=l("A");return n(n({state:o,state_1:p,max_winning_streak:d,group_name:g},m),{on_count:n=>{e.count2(n)},data:1})}});const j=m("span",{style:{"font-size":"20px"}},null,-1);x.render=function(n,e,a,t,r,o){const s=_("RankPlayer"),l=_("van-row"),u=_("van-cell-group"),w=_("RankAction");return i(),c("div",null,[j,m(u,{title:"积分排名："},{default:p((()=>[m(l,null,{default:p((()=>[(i(!0),c(d,null,g(n.state.player_arr,((n,e)=>(i(),c(s,{key:n.name,player:n},null,8,["player"])))),128))])),_:1})])),_:1}),m(w)])};export default x;
