import{j as e,$ as t,E as a,m as o,N as i,R as s,P as r,n,L as l}from"./index.6b048fe1.js";import"./vendor.32f4224e.js";var g,m;(m=g||(g={})).JIFEN="jifen",m.QIUYUAN="guest",m.ADMIN="admin";const c=class{static async verify(s){if(e("dev"))return c.role="admin",t.emit(a.login_role,g.ADMIN),!0;let r=await o.post("/v3/event-regular/jwt/verify",{ticket:s});return"sus"===r.msg?(c.update_role(r),!0):(i({type:"danger",message:"非法ticket"}),c.removeToken(),!1)}static async login(e){let t=await o.get2(`/v3/event-regular/jwt/get?phone=${e}`);if("sus"===t.msg){let{ticket:e,phone:a,role:o}=t;return await c.removeToken(),c.setToken(e),c.update_role(t),i({type:"success",message:"登陆成功"}),!0}i({type:"warning",message:"登陆失败 "+t.msg})}static logout(){c.role="",c.phone="",c.game_id="",c.exp_date="",c.removeToken(),c.goto_login()}static login_guest(){c.role=g.QIUYUAN,t.emit(a.login_role,g.QIUYUAN)}static goto_login(){s.to(r.BASE_HOME)}static update_role(e){c.exp_date=n.format_date(new Date(1e3*e.exp),"yy年MM月dd hh:mm:ss"),c.role=e.role,c.game_id=e.game_id,c.phone=e.phone,t.emit(a.login_role,c.role)}static async bind_phone_to_game_id(e,t,a){if("admin"===c.role){let i=await o.get2(`/v3/event-regular/jwt/bind/${e}/to/${t}?role=${a}`);if("sus"===i.msg){let{ticket:e,phone:t,game_id:a}=i;return{ticket:e,phone:t,game_id:a}}}}static setToken(e){l.set_item("ticket",e),localStorage.setItem("ticket",e)}static getToken(){let e="";return e=localStorage.getItem("ticket"),e}static removeToken(){l.set_item("ticket",""),localStorage.removeItem("ticket")}};let _=c;_.role=g.QIUYUAN,_.exp_date="",_.game_id="",_.phone="";export{_ as A,g as R};
